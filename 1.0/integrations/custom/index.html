
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://hishel.com/1.0/integrations/custom/">
      
      
        <link rel="prev" href="../blacksheep/">
      
      
        <link rel="next" href="../../contributing/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>Custom Integrations - Hishel</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../docs/custom.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="amber" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#custom-integrations" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Hishel" class="md-header__button md-logo" aria-label="Hishel" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Hishel
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Custom Integrations
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="amber" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="amber" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/karpetrosyan/hishel" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Hishel" class="md-nav__button md-logo" aria-label="Hishel" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Hishel
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/karpetrosyan/hishel" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m20 22-3.86-1.55c.7-1.53 1.2-3.11 1.51-4.72zM7.86 20.45 4 22l2.35-6.27c.31 1.61.81 3.19 1.51 4.72M12 2s5 2 5 10c0 3.1-.75 5.75-1.67 7.83A2 2 0 0 1 13.5 21h-3a2 2 0 0 1-1.83-1.17C7.76 17.75 7 15.1 7 12c0-8 5-10 5-10m0 10c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2"/></svg>
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../storages/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 3C7.58 3 4 4.79 4 7s3.58 4 8 4 8-1.79 8-4-3.58-4-8-4M4 9v3c0 2.21 3.58 4 8 4s8-1.79 8-4V9c0 2.21-3.58 4-8 4s-8-1.79-8-4m0 5v3c0 2.21 3.58 4 8 4s8-1.79 8-4v-3c0 2.21-3.58 4-8 4s-8-1.79-8-4"/></svg>
  
  <span class="md-ellipsis">
    Storages
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../metadata/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16 20h4v-4h-4m0-2h4v-4h-4m-6-2h4V4h-4m6 4h4V4h-4m-6 10h4v-4h-4m-6 4h4v-4H4m0 10h4v-4H4m6 4h4v-4h-4M4 8h4V4H4z"/></svg>
  
  <span class="md-ellipsis">
    Metadata
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../specification/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2M7.5 13A2.5 2.5 0 0 0 5 15.5 2.5 2.5 0 0 0 7.5 18a2.5 2.5 0 0 0 2.5-2.5A2.5 2.5 0 0 0 7.5 13m9 0a2.5 2.5 0 0 0-2.5 2.5 2.5 2.5 0 0 0 2.5 2.5 2.5 2.5 0 0 0 2.5-2.5 2.5 2.5 0 0 0-2.5-2.5"/></svg>
  
  <span class="md-ellipsis">
    Sans-I/O Caching
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Integrations
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Integrations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../httpx/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 21h-2V6L9.03 3.97 10 3l2 2 2-2 1 1-2 2zM7 6a5.002 5.002 0 0 0-3 9v2c0 2.21 1.79 4 4 4 .72 0 1.39-.19 1.97-.5l.03-.04V7c-.84-.63-1.87-1-3-1m-.5 6.5L5 11l1.5-1.5L8 11zM22 11c0-2.76-2.24-5-5-5-1.12 0-2.15.37-3 1v13.46c.59.35 1.27.54 2 .54 2.21 0 4-1.79 4-4v-2c1.21-.91 2-2.36 2-4m-4.5 1.5L16 11l1.5-1.5L19 11z"/></svg>
  
  <span class="md-ellipsis">
    httpx
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../requests/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.25.18.9.2.73.26.59.3.45.32.34.34.25.34.16.33.1.3.04.26.02.2-.01.13V8.5l-.05.63-.13.55-.21.46-.26.38-.3.31-.33.25-.35.19-.35.14-.33.1-.3.07-.26.04-.21.02H8.77l-.69.05-.59.14-.5.22-.41.27-.33.32-.27.35-.2.36-.15.37-.1.35-.07.32-.04.27-.02.21v3.06H3.17l-.21-.03-.28-.07-.32-.12-.35-.18-.36-.26-.36-.36-.35-.46-.32-.59-.28-.73-.21-.88-.14-1.05-.05-1.23.06-1.22.16-1.04.24-.87.32-.71.36-.57.4-.44.42-.33.42-.24.4-.16.36-.1.32-.05.24-.01h.16l.06.01h8.16v-.83H6.18l-.01-2.75-.02-.37.05-.34.11-.31.17-.28.25-.26.31-.23.38-.2.44-.18.51-.15.58-.12.64-.1.71-.06.77-.04.84-.02 1.27.05zm-6.3 1.98-.23.33-.08.41.08.41.23.34.33.22.41.09.41-.09.33-.22.23-.34.08-.41-.08-.41-.23-.33-.33-.22-.41-.09-.41.09zm13.09 3.95.28.06.32.12.35.18.36.27.36.35.35.47.32.59.28.73.21.88.14 1.04.05 1.23-.06 1.23-.16 1.04-.24.86-.32.71-.36.57-.4.45-.42.33-.42.24-.4.16-.36.09-.32.05-.24.02-.16-.01h-8.22v.82h5.84l.01 2.76.02.36-.05.34-.11.31-.17.29-.25.25-.31.24-.38.2-.44.17-.51.15-.58.13-.64.09-.71.07-.77.04-.84.01-1.27-.04-1.07-.14-.9-.2-.73-.25-.59-.3-.45-.33-.34-.34-.25-.34-.16-.33-.1-.3-.04-.25-.02-.2.01-.13v-5.34l.05-.64.13-.54.21-.46.26-.38.3-.32.33-.24.35-.2.35-.14.33-.1.3-.06.26-.04.21-.02.13-.01h5.84l.69-.05.59-.14.5-.21.41-.28.33-.32.27-.35.2-.36.15-.36.1-.35.07-.32.04-.28.02-.21V6.07h2.09l.14.01zm-6.47 14.25-.23.33-.08.41.08.41.23.33.33.23.41.08.41-.08.33-.23.23-.33.08-.41-.08-.41-.23-.33-.33-.23-.41-.08-.41.08z"/></svg>
  
  <span class="md-ellipsis">
    requests
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../asgi/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.36 14c.08-.66.14-1.32.14-2s-.06-1.34-.14-2h3.38c.16.64.26 1.31.26 2s-.1 1.36-.26 2m-5.15 5.56c.6-1.11 1.06-2.31 1.38-3.56h2.95a8.03 8.03 0 0 1-4.33 3.56M14.34 14H9.66c-.1-.66-.16-1.32-.16-2s.06-1.35.16-2h4.68c.09.65.16 1.32.16 2s-.07 1.34-.16 2M12 19.96c-.83-1.2-1.5-2.53-1.91-3.96h3.82c-.41 1.43-1.08 2.76-1.91 3.96M8 8H5.08A7.92 7.92 0 0 1 9.4 4.44C8.8 5.55 8.35 6.75 8 8m-2.92 8H8c.35 1.25.8 2.45 1.4 3.56A8 8 0 0 1 5.08 16m-.82-2C4.1 13.36 4 12.69 4 12s.1-1.36.26-2h3.38c-.08.66-.14 1.32-.14 2s.06 1.34.14 2M12 4.03c.83 1.2 1.5 2.54 1.91 3.97h-3.82c.41-1.43 1.08-2.77 1.91-3.97M18.92 8h-2.95a15.7 15.7 0 0 0-1.38-3.56c1.84.63 3.37 1.9 4.33 3.56M12 2C6.47 2 2 6.5 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10A10 10 0 0 0 12 2"/></svg>
  
  <span class="md-ellipsis">
    ASGI
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fastapi/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 .039c-6.627 0-12 5.354-12 11.96-.001 6.606 5.372 11.963 12 11.962S24.001 18.605 24 12 18.627.039 12 .039m-.829 5.415h7.55l-7.58 5.329h5.182L5.28 18.543Q8.226 12 11.171 5.455"/></svg>
  
  <span class="md-ellipsis">
    FastAPI
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../blacksheep/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 8.5a2.5 2.5 0 0 1-2.5 2.5c-1.08 0-2-.69-2.34-1.64-.44.39-1.02.64-1.66.64-.56 0-1.08-.19-1.5-.5-.42.31-.93.5-1.5.5-.64 0-1.22-.25-1.66-.64C8.5 10.31 7.58 11 6.5 11A2.5 2.5 0 0 1 4 8.5c0-1.24.91-2.27 2.1-2.46-.06-.17-.1-.35-.1-.54A1.5 1.5 0 0 1 7.5 4c.2 0 .39.04.56.11C8.23 3.47 8.81 3 9.5 3c.25 0 .5.07.68.17C10.5 2.5 11.19 2 12 2s1.5.5 1.82 1.17c.18-.1.43-.17.68-.17.69 0 1.27.47 1.44 1.11.17-.07.36-.11.56-.11A1.5 1.5 0 0 1 18 5.5c0 .19-.04.37-.1.54 1.19.19 2.1 1.22 2.1 2.46M10 12a1 1 0 0 0-1 1 1 1 0 0 0 1 1 1 1 0 0 0 1-1 1 1 0 0 0-1-1m4 0a1 1 0 0 0-1 1 1 1 0 0 0 1 1 1 1 0 0 0 1-1 1 1 0 0 0-1-1m6.23-1.34c-.64.81-1.62 1.34-2.73 1.34-.45 0-.88-.1-1.29-.27-.01 2.55-.38 5.63-1.76 7.22-.52.59-1.15.91-1.95 1.01V18h-1v1.96c-.8-.1-1.43-.41-1.95-1.01-1.39-1.6-1.76-4.66-1.77-7.21-.4.16-.83.26-1.28.26-1.11 0-2.09-.53-2.73-1.34C2.88 11.55 2 12 2 12s1 2 3 2c.36 0 .64-.04.88-.09C6.22 17.73 7.58 22 12 22s5.78-4.27 6.12-8.09c.24.05.52.09.88.09 2 0 3-2 3-2s-.88-.45-1.77-1.34"/></svg>
  
  <span class="md-ellipsis">
    Blacksheep
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 10c0-.65-.43-1.3-1-1.68-.3-.2-.65-.32-1-.32V4H8v4H4V4H2v4c-1 0-2 1-2 2v5.5L3.5 19v3h5v-3l3.5-3.5zm.33-6c-.11 0-.22 0-.33.04v2.55c.3.18.56.41.79.62C13.44 7.87 14 8.85 14 10v6.33l-3 3v1.34c0 .73.6 1.33 1.33 1.33h9.34c.33 0 .69-.14.94-.39s.39-.61.39-.94V5.33C23 4.6 22.4 4 21.67 4H20V2h-6v2z"/></svg>
  
  <span class="md-ellipsis">
    Custom Integrations
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 10c0-.65-.43-1.3-1-1.68-.3-.2-.65-.32-1-.32V4H8v4H4V4H2v4c-1 0-2 1-2 2v5.5L3.5 19v3h5v-3l3.5-3.5zm.33-6c-.11 0-.22 0-.33.04v2.55c.3.18.56.41.79.62C13.44 7.87 14 8.85 14 10v6.33l-3 3v1.34c0 .73.6 1.33 1.33 1.33h9.34c.33 0 .69-.14.94-.39s.39-.61.39-.94V5.33C23 4.6 22.4 4 21.67 4H20V2h-6v2z"/></svg>
  
  <span class="md-ellipsis">
    Custom Integrations
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#converting-requestresponse-models" class="md-nav__link">
    <span class="md-ellipsis">
      Converting Request/Response Models
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Converting Request/Response Models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#core-conversion-principles" class="md-nav__link">
    <span class="md-ellipsis">
      Core Conversion Principles
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-cache-proxy-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Using Cache Proxy Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Using Cache Proxy Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#asynccacheproxy" class="md-nav__link">
    <span class="md-ellipsis">
      AsyncCacheProxy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synccacheproxy" class="md-nav__link">
    <span class="md-ellipsis">
      SyncCacheProxy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration-example-httpx" class="md-nav__link">
    <span class="md-ellipsis">
      Integration Example: httpx
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#when-to-use-cache-proxy-classes" class="md-nav__link">
    <span class="md-ellipsis">
      When to Use Cache Proxy Classes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration-options" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration Options
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation-example" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation Example
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common-pitfalls-and-solutions" class="md-nav__link">
    <span class="md-ellipsis">
      Common Pitfalls and Solutions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Common Pitfalls and Solutions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stream-consumption" class="md-nav__link">
    <span class="md-ellipsis">
      Stream Consumption
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#header-filtering" class="md-nav__link">
    <span class="md-ellipsis">
      Header Filtering
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-your-integration" class="md-nav__link">
    <span class="md-ellipsis">
      Testing Your Integration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Testing Your Integration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-test-case" class="md-nav__link">
    <span class="md-ellipsis">
      Example Test Case
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integration-template" class="md-nav__link">
    <span class="md-ellipsis">
      Integration Template
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#need-help" class="md-nav__link">
    <span class="md-ellipsis">
      Need Help?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#related-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      Related Documentation
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16 2c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5m0 8c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3 6h-2c0-1.2-.75-2.28-1.87-2.7L8.97 11H1v11h6v-1.44l7 1.94 8-2.5v-1c0-1.66-1.34-3-3-3M5 20H3v-7h2zm8.97.41L7 18.5V13h1.61l5.82 2.17c.34.13.57.46.57.83 0 0-2-.05-2.3-.15l-2.38-.79-.63 1.9 2.38.79c.51.17 1.04.25 1.58.25H19c.39 0 .74.24.9.57z"/></svg>
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#converting-requestresponse-models" class="md-nav__link">
    <span class="md-ellipsis">
      Converting Request/Response Models
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Converting Request/Response Models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#core-conversion-principles" class="md-nav__link">
    <span class="md-ellipsis">
      Core Conversion Principles
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-cache-proxy-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Using Cache Proxy Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Using Cache Proxy Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#asynccacheproxy" class="md-nav__link">
    <span class="md-ellipsis">
      AsyncCacheProxy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synccacheproxy" class="md-nav__link">
    <span class="md-ellipsis">
      SyncCacheProxy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration-example-httpx" class="md-nav__link">
    <span class="md-ellipsis">
      Integration Example: httpx
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#when-to-use-cache-proxy-classes" class="md-nav__link">
    <span class="md-ellipsis">
      When to Use Cache Proxy Classes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration-options" class="md-nav__link">
    <span class="md-ellipsis">
      Configuration Options
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation-example" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation Example
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#common-pitfalls-and-solutions" class="md-nav__link">
    <span class="md-ellipsis">
      Common Pitfalls and Solutions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Common Pitfalls and Solutions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stream-consumption" class="md-nav__link">
    <span class="md-ellipsis">
      Stream Consumption
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#header-filtering" class="md-nav__link">
    <span class="md-ellipsis">
      Header Filtering
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-your-integration" class="md-nav__link">
    <span class="md-ellipsis">
      Testing Your Integration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Testing Your Integration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-test-case" class="md-nav__link">
    <span class="md-ellipsis">
      Example Test Case
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integration-template" class="md-nav__link">
    <span class="md-ellipsis">
      Integration Template
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#need-help" class="md-nav__link">
    <span class="md-ellipsis">
      Need Help?
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#related-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      Related Documentation
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="custom-integrations">Custom Integrations</h1>
<p>Hishel is designed to be flexible and easy to integrate with any HTTP client or server. This guide will help you build custom integrations for libraries that aren't yet supported out of the box.</p>
<h2 id="converting-requestresponse-models">Converting Request/Response Models</h2>
<p>The core of any Hishel integration is converting your library's request/response models to Hishel's internal <code>Request</code> and <code>Response</code> models. This translation layer allows Hishel to cache responses regardless of which HTTP library you're using.</p>
<p>In the Hishel codebase, you'll find conversion methods like <code>httpx_to_internal</code>, <code>requests_to_internal</code>, etc. that handle popular libraries. You can use these as reference implementations when building your own integration.</p>
<h3 id="core-conversion-principles">Core Conversion Principles</h3>
<p>Follow these guidelines when converting models:</p>
<p><strong>Response Content</strong>
: The response content should be the actual data, possibly compressed, but decoded if it was sent with transfer encoding (like chunked). This content must be reusable—if you store compressed data, also preserve the <code>Content-Encoding</code> header so it can be decoded later.</p>
<p><strong>Headers</strong>
: Store headers as-is, except for headers that the HTTP specification doesn't allow caching. Important: If a response stream has already been consumed and decoded into memory before reaching the cache layer, you must remove the <code>Content-Encoding</code> header since the content is no longer encoded.</p>
<p><strong>Requests</strong>
: Converting request models is simpler than responses. Hishel doesn't recreate requests from cache or store request body streams—only headers, method, and URL are needed. The converted request may be modified by Hishel before being sent to the server, but exact preservation of the request body isn't critical.</p>
<h2 id="using-cache-proxy-classes">Using Cache Proxy Classes</h2>
<p>Hishel provides <code>AsyncCacheProxy</code> and <code>SyncCacheProxy</code> helper classes that handle all the caching logic for you. These classes are independent of any specific HTTP library and work only with Hishel's internal models, making them perfect for building new integrations.</p>
<h3 id="asynccacheproxy">AsyncCacheProxy</h3>
<p>The <code>AsyncCacheProxy</code> class manages the entire HTTP caching state machine. You simply provide it with a function that sends requests, and it handles:</p>
<ul>
<li>Cache key generation</li>
<li>Storage operations</li>
<li>RFC 9111 compliance</li>
<li>State machine transitions</li>
<li>TTL management</li>
</ul>
<p><strong>Basic Usage:</strong></p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">hishel</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncCacheProxy</span><span class="p">,</span> <span class="n">AsyncSqliteStorage</span><span class="p">,</span> <span class="n">CacheOptions</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">send_request</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Response</span><span class="p">:</span>
    <span class="c1"># Your code to send the HTTP request</span>
    <span class="c1"># This is where you convert from internal models to your library</span>
    <span class="c1"># and back</span>
    <span class="k">pass</span>

<span class="c1"># Create the cache proxy</span>
<span class="n">cache_proxy</span> <span class="o">=</span> <span class="n">AsyncCacheProxy</span><span class="p">(</span>
    <span class="n">request_sender</span><span class="o">=</span><span class="n">send_request</span><span class="p">,</span>
    <span class="n">storage</span><span class="o">=</span><span class="n">AsyncSqliteStorage</span><span class="p">(),</span>  <span class="c1"># Optional, defaults to AsyncSqliteStorage</span>
    <span class="n">cache_options</span><span class="o">=</span><span class="n">CacheOptions</span><span class="p">(),</span>   <span class="c1"># Optional, defaults to CacheOptions()</span>
    <span class="n">ignore_specification</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>     <span class="c1"># Optional, set True to bypass RFC 9111</span>
<span class="p">)</span>

<span class="c1"># Handle a request with caching</span>
<span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">cache_proxy</span><span class="o">.</span><span class="n">handle_request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</code></pre></div>
<p><strong>Key Features:</strong></p>
<ul>
<li><strong>Automatic cache key generation</strong>: Based on URL and optional request body hashing</li>
<li><strong>Spec-compliant caching</strong>: Full RFC 9111 state machine handling</li>
<li><strong>Spec-ignoring mode</strong>: Simple cache lookup without RFC 9111 rules</li>
<li><strong>TTL refresh</strong>: Automatic TTL updates on cache access if configured</li>
<li><strong>Vary header support</strong>: Proper handling of content negotiation</li>
</ul>
<h3 id="synccacheproxy">SyncCacheProxy</h3>
<p>The synchronous version works identically but for blocking I/O:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">hishel</span><span class="w"> </span><span class="kn">import</span> <span class="n">SyncCacheProxy</span><span class="p">,</span> <span class="n">SyncSqliteStorage</span>

<span class="k">def</span><span class="w"> </span><span class="nf">send_request</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Response</span><span class="p">:</span>
    <span class="c1"># Your synchronous request sending code</span>
    <span class="k">pass</span>

<span class="n">cache_proxy</span> <span class="o">=</span> <span class="n">SyncCacheProxy</span><span class="p">(</span>
    <span class="n">request_sender</span><span class="o">=</span><span class="n">send_request</span><span class="p">,</span>
    <span class="n">storage</span><span class="o">=</span><span class="n">SyncSqliteStorage</span><span class="p">(),</span>
    <span class="n">cache_options</span><span class="o">=</span><span class="n">CacheOptions</span><span class="p">(),</span>
    <span class="n">ignore_specification</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">cache_proxy</span><span class="o">.</span><span class="n">handle_request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</code></pre></div>
<h3 id="integration-example-httpx">Integration Example: httpx</h3>
<p>Here's how the httpx integration uses <code>AsyncCacheProxy</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">hishel</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncCacheProxy</span><span class="p">,</span> <span class="n">Request</span><span class="p">,</span> <span class="n">Response</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">httpx</span>

<span class="k">class</span><span class="w"> </span><span class="nc">AsyncCacheTransport</span><span class="p">(</span><span class="n">httpx</span><span class="o">.</span><span class="n">AsyncBaseTransport</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">next_transport</span><span class="p">:</span> <span class="n">httpx</span><span class="o">.</span><span class="n">AsyncBaseTransport</span><span class="p">,</span>
        <span class="n">storage</span><span class="p">:</span> <span class="n">AsyncBaseStorage</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cache_options</span><span class="p">:</span> <span class="n">CacheOptions</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_transport</span> <span class="o">=</span> <span class="n">next_transport</span>

        <span class="c1"># Define how to send a request using the underlying transport</span>
        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">send_request</span><span class="p">(</span><span class="n">internal_request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Response</span><span class="p">:</span>
            <span class="c1"># Convert internal Request to httpx.Request</span>
            <span class="n">httpx_request</span> <span class="o">=</span> <span class="n">internal_to_httpx</span><span class="p">(</span><span class="n">internal_request</span><span class="p">)</span>

            <span class="c1"># Send using underlying transport</span>
            <span class="n">httpx_response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transport</span><span class="o">.</span><span class="n">handle_async_request</span><span class="p">(</span><span class="n">httpx_request</span><span class="p">)</span>

            <span class="c1"># Convert httpx.Response to internal Response</span>
            <span class="k">return</span> <span class="n">httpx_to_internal</span><span class="p">(</span><span class="n">httpx_response</span><span class="p">)</span>

        <span class="c1"># Create the cache proxy with our send function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cache_proxy</span> <span class="o">=</span> <span class="n">AsyncCacheProxy</span><span class="p">(</span>
            <span class="n">request_sender</span><span class="o">=</span><span class="n">send_request</span><span class="p">,</span>
            <span class="n">storage</span><span class="o">=</span><span class="n">storage</span><span class="p">,</span>
            <span class="n">cache_options</span><span class="o">=</span><span class="n">cache_options</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">handle_async_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Response</span><span class="p">:</span>
        <span class="c1"># Convert httpx.Request to internal Request</span>
        <span class="n">internal_request</span> <span class="o">=</span> <span class="n">httpx_to_internal</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

        <span class="c1"># Let the cache proxy handle the request</span>
        <span class="n">internal_response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache_proxy</span><span class="o">.</span><span class="n">handle_request</span><span class="p">(</span><span class="n">internal_request</span><span class="p">)</span>

        <span class="c1"># Convert internal Response back to httpx.Response</span>
        <span class="k">return</span> <span class="n">internal_to_httpx</span><span class="p">(</span><span class="n">internal_response</span><span class="p">)</span>
</code></pre></div>
<h3 id="when-to-use-cache-proxy-classes">When to Use Cache Proxy Classes</h3>
<p><strong>Use <code>AsyncCacheProxy</code>/<code>SyncCacheProxy</code> when:</strong></p>
<ul>
<li>✅ Building a new integration from scratch</li>
<li>✅ You want automatic RFC 9111 compliance</li>
<li>✅ You need both spec-respecting and spec-ignoring modes</li>
<li>✅ You want to focus on model conversion, not caching logic</li>
</ul>
<h3 id="configuration-options">Configuration Options</h3>
<p>Both proxy classes accept these parameters:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>request_sender</code></td>
<td><code>Callable</code></td>
<td><strong>Required</strong></td>
<td>Function that sends requests using your HTTP library</td>
</tr>
<tr>
<td><code>storage</code></td>
<td><code>AsyncBaseStorage</code> / <code>SyncBaseStorage</code></td>
<td><code>AsyncSqliteStorage()</code> / <code>SyncSqliteStorage()</code></td>
<td>Where to store cached responses</td>
</tr>
<tr>
<td><code>cache_options</code></td>
<td><code>CacheOptions</code></td>
<td><code>CacheOptions()</code></td>
<td>RFC 9111 behavior configuration</td>
</tr>
<tr>
<td><code>ignore_specification</code></td>
<td><code>bool</code></td>
<td><code>False</code></td>
<td>Set <code>True</code> to bypass RFC 9111 and cache everything</td>
</tr>
</tbody>
</table>
<h2 id="implementation-example">Implementation Example</h2>
<p>Here's how to translate synchronous httpx Request/Response models to Hishel's internal models:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">httpx</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Iterator</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">cast</span><span class="p">,</span> <span class="n">overload</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hishel.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Request</span><span class="p">,</span> <span class="n">Response</span><span class="p">,</span> <span class="n">RequestMetadata</span><span class="p">,</span> <span class="n">Headers</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hishel.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">filter_mapping</span><span class="p">,</span> <span class="n">make_sync_iterator</span>

<span class="c1"># 128 KB</span>
<span class="n">CHUNK_SIZE</span> <span class="o">=</span> <span class="mi">131072</span>


<span class="nd">@overload</span>
<span class="k">def</span><span class="w"> </span><span class="nf">httpx_to_internal</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Request</span><span class="p">:</span> <span class="o">...</span>
<span class="nd">@overload</span>
<span class="k">def</span><span class="w"> </span><span class="nf">httpx_to_internal</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Response</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Response</span><span class="p">:</span> <span class="o">...</span>
<span class="k">def</span><span class="w"> </span><span class="nf">httpx_to_internal</span><span class="p">(</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">httpx</span><span class="o">.</span><span class="n">Request</span><span class="p">,</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Response</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Request</span><span class="p">,</span> <span class="n">Response</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert httpx.Request/httpx.Response to internal Request/Response.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="n">Headers</span><span class="p">(</span>
        <span class="n">filter_mapping</span><span class="p">(</span>
            <span class="n">Headers</span><span class="p">({</span><span class="n">key</span><span class="p">:</span> <span class="n">value</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">items</span><span class="p">()}),</span>
            <span class="p">[</span><span class="s2">&quot;Transfer-Encoding&quot;</span><span class="p">],</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Request</span><span class="p">):</span>
        <span class="n">extension_metadata</span> <span class="o">=</span> <span class="n">RequestMetadata</span><span class="p">(</span>
            <span class="n">hishel_refresh_ttl_on_access</span><span class="o">=</span><span class="n">value</span><span class="o">.</span><span class="n">extensions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;hishel_refresh_ttl_on_access&quot;</span><span class="p">),</span>
            <span class="n">hishel_ttl</span><span class="o">=</span><span class="n">value</span><span class="o">.</span><span class="n">extensions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;hishel_ttl&quot;</span><span class="p">),</span>
            <span class="n">hishel_spec_ignore</span><span class="o">=</span><span class="n">value</span><span class="o">.</span><span class="n">extensions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;hishel_spec_ignore&quot;</span><span class="p">),</span>
            <span class="n">hishel_body_key</span><span class="o">=</span><span class="n">value</span><span class="o">.</span><span class="n">extensions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;hishel_body_key&quot;</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">headers_metadata</span> <span class="o">=</span> <span class="n">extract_metadata_from_headers</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">headers</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">extension_metadata</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">extensions</span><span class="p">:</span>
                <span class="n">headers_metadata</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

        <span class="k">return</span> <span class="n">Request</span><span class="p">(</span>
            <span class="n">method</span><span class="o">=</span><span class="n">value</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
            <span class="n">url</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">url</span><span class="p">),</span>
            <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
            <span class="n">stream</span><span class="o">=</span><span class="n">cast</span><span class="p">(</span><span class="n">Iterator</span><span class="p">[</span><span class="nb">bytes</span><span class="p">],</span> <span class="n">value</span><span class="o">.</span><span class="n">stream</span><span class="p">),</span>
            <span class="n">metadata</span><span class="o">=</span><span class="n">headers_metadata</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">httpx</span><span class="o">.</span><span class="n">Response</span><span class="p">):</span>
        <span class="n">stream</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">make_sync_iterator</span><span class="p">([</span><span class="n">value</span><span class="o">.</span><span class="n">content</span><span class="p">])</span> <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">is_stream_consumed</span> <span class="k">else</span> <span class="n">value</span><span class="o">.</span><span class="n">iter_raw</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="n">CHUNK_SIZE</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">value</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
            <span class="n">stream</span><span class="o">=</span><span class="n">stream</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="p">{},</span>
        <span class="p">)</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Critical: Stream Must Be Available</p>
<p>If a stream was consumed without being read into memory, there's no way to access the data. Hishel will raise an error in this case to prevent silent data loss.</p>
</div>
<h2 id="common-pitfalls-and-solutions">Common Pitfalls and Solutions</h2>
<h3 id="stream-consumption">Stream Consumption</h3>
<p>Always ensure consumed streams are stored in memory before conversion. Check your library's documentation for methods like <code>is_stream_consumed</code> or <code>content</code> that indicate whether data is still available.</p>
<p><strong>Best Practice</strong>: Read the stream into memory before creating the Hishel Response:
<div class="highlight"><pre><span></span><code><span class="c1"># Good: Stream is preserved</span>
<span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">is_stream_consumed</span><span class="p">:</span>
    <span class="n">stream</span> <span class="o">=</span> <span class="n">make_iterator</span><span class="p">([</span><span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">])</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">stream</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">iter_raw</span><span class="p">()</span>

<span class="c1"># Bad: Stream was consumed elsewhere without storing</span>
<span class="c1"># This will fail when Hishel tries to cache</span>
</code></pre></div></p>
<h3 id="header-filtering">Header Filtering</h3>
<div class="admonition tip">
<p class="admonition-title">Which Headers to Remove</p>
<p>Remove these headers when caching responses:</p>
<p><strong>Hop-by-hop headers</strong> (never cached):</p>
<ul>
<li><code>Connection</code></li>
<li><code>Keep-Alive</code></li>
<li><code>Proxy-Authenticate</code></li>
<li><code>Proxy-Authorization</code></li>
<li><code>TE</code></li>
<li><code>Trailers</code></li>
<li><code>Transfer-Encoding</code></li>
<li><code>Upgrade</code></li>
</ul>
<p><strong>Encoding headers</strong> (remove only if content is decoded):</p>
<ul>
<li><code>Content-Encoding</code> - Remove when you've decoded the content</li>
</ul>
</div>
<h2 id="testing-your-integration">Testing Your Integration</h2>
<p>When implementing a custom integration, test these scenarios:</p>
<ol>
<li><strong>Basic caching flow</strong> - Request → Response → Cache → Retrieve</li>
<li><strong>Compressed responses</strong> - gzip, deflate, brotli</li>
<li><strong>Chunked transfer encoding</strong> - Verify proper handling</li>
<li><strong>Stream states</strong> - Both consumed and unconsumed streams</li>
<li><strong>HTTP status codes</strong> - 200, 304, 404, 500, etc.</li>
<li><strong>Content types</strong> - JSON, HTML, binary data, large files</li>
<li><strong>Request metadata</strong> - Custom Hishel extensions and TTL settings</li>
</ol>
<h3 id="example-test-case">Example Test Case</h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_basic_caching</span><span class="p">():</span>
    <span class="c1"># Create a request</span>
    <span class="n">request</span> <span class="o">=</span> <span class="n">mylib</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;https://example.com&quot;</span><span class="p">)</span>

    <span class="c1"># Convert to internal model</span>
    <span class="n">internal_request</span> <span class="o">=</span> <span class="n">mylib_to_internal</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

    <span class="c1"># Verify conversion</span>
    <span class="k">assert</span> <span class="n">internal_request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;GET&quot;</span>
    <span class="k">assert</span> <span class="n">internal_request</span><span class="o">.</span><span class="n">url</span> <span class="o">==</span> <span class="s2">&quot;https://example.com&quot;</span>
    <span class="k">assert</span> <span class="s2">&quot;Transfer-Encoding&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">internal_request</span><span class="o">.</span><span class="n">headers</span>
</code></pre></div>
<h2 id="integration-template">Integration Template</h2>
<p>Here's a template to get started with integrating a new library:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Union</span><span class="p">,</span> <span class="n">overload</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hishel.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Request</span><span class="p">,</span> <span class="n">Response</span><span class="p">,</span> <span class="n">Headers</span><span class="p">,</span> <span class="n">RequestMetadata</span>

<span class="nd">@overload</span>
<span class="k">def</span><span class="w"> </span><span class="nf">mylib_to_internal</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">MyLibRequest</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Request</span><span class="p">:</span> <span class="o">...</span>

<span class="nd">@overload</span>
<span class="k">def</span><span class="w"> </span><span class="nf">mylib_to_internal</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">MyLibResponse</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Response</span><span class="p">:</span> <span class="o">...</span>

<span class="k">def</span><span class="w"> </span><span class="nf">mylib_to_internal</span><span class="p">(</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">MyLibRequest</span><span class="p">,</span> <span class="n">MyLibResponse</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Request</span><span class="p">,</span> <span class="n">Response</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert MyLib models to Hishel internal models.&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">MyLibRequest</span><span class="p">):</span>
        <span class="c1"># Extract method, URL, and headers</span>
        <span class="n">method</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">method</span>
        <span class="n">url</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="n">Headers</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>

        <span class="c1"># Create request stream if body exists</span>
        <span class="n">stream</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">stream</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;stream&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="nb">iter</span><span class="p">([])</span>

        <span class="c1"># Extract Hishel metadata from extensions/extras if available</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;extensions&#39;</span><span class="p">):</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;hishel_ttl&#39;</span><span class="p">:</span> <span class="n">value</span><span class="o">.</span><span class="n">extensions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;hishel_ttl&#39;</span><span class="p">),</span>
                <span class="c1"># Add other metadata as needed</span>
            <span class="p">}</span>

        <span class="k">return</span> <span class="n">Request</span><span class="p">(</span>
            <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
            <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
            <span class="n">stream</span><span class="o">=</span><span class="n">stream</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">MyLibResponse</span><span class="p">):</span>
        <span class="c1"># Extract status code</span>
        <span class="n">status_code</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">status_code</span>

        <span class="c1"># Filter headers (remove hop-by-hop and encoding headers if needed)</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="n">Headers</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>
        <span class="c1"># Remove Transfer-Encoding</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="n">filter_headers</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Transfer-Encoding&quot;</span><span class="p">])</span>

        <span class="c1"># Handle stream consumption state</span>
        <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">is_consumed</span><span class="p">:</span>
            <span class="c1"># Stream was consumed, use stored content</span>
            <span class="n">stream</span> <span class="o">=</span> <span class="n">make_iterator</span><span class="p">([</span><span class="n">value</span><span class="o">.</span><span class="n">content</span><span class="p">])</span>
            <span class="c1"># Remove Content-Encoding if content was decoded</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="n">filter_headers</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;Content-Encoding&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Stream still available</span>
            <span class="n">stream</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="mi">131072</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Response</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status_code</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
            <span class="n">stream</span><span class="o">=</span><span class="n">stream</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="p">{},</span>
        <span class="p">)</span>
</code></pre></div>
<h2 id="need-help">Need Help?</h2>
<p>If you're building an integration and encounter issues:</p>
<ol>
<li><strong>Check existing integrations</strong> - Look at httpx, requests, and aiohttp implementations in the Hishel codebase</li>
<li><strong>Open an issue</strong> - Post your use case on <a href="https://github.com/karpetrosyan/hishel/issues">GitHub Issues</a></li>
<li><strong>Contribute back</strong> - Consider contributing your integration to help others!</li>
</ol>
<h2 id="related-documentation">Related Documentation</h2>
<ul>
<li><a href="../storage/">Storage Backends</a> - Understanding where responses are cached</li>
<li><a href="../policies/">Cache Policies</a> - How Hishel decides what to cache  </li>
<li><a href="../api/">API Reference</a> - Detailed model specifications</li>
</ul>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.expand"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.50899def.min.js"></script>
      
    
  </body>
</html>